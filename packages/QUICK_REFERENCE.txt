â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          PSEUDOARBITRAGE AMM - QUICK REFERENCE GUIDE                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ YOUR FILES (Organize These)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Original Files â†’ Where They Go:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PseudoArbitrage.sol             â”‚ â†’ src/instructions/            â”‚
â”‚ PseudoArbitrageOpcodes.sol      â”‚ â†’ src/opcodes/                 â”‚
â”‚ PseudoArbitrageAMM.sol          â”‚ â†’ src/strategies/              â”‚
â”‚ PseudoArbitrageSwapVMRouter.sol â”‚ â†’ src/routers/                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“š DOCUMENTATION (Read These)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. â­ README.md
   â””â”€â†’ Start here! Complete overview and quick start guide

2. ğŸ“‹ DEPLOYMENT_GUIDE.md
   â””â”€â†’ Architecture overview and deployment strategy

3. ğŸ“– STEP_BY_STEP_GUIDE.md
   â””â”€â†’ Detailed walkthrough with commands and troubleshooting

ğŸ”§ SCRIPTS & TOOLS (Use These)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. âš™ï¸ setup.sh (Automated Setup)
   â””â”€â†’ chmod +x setup.sh && ./setup.sh
   â””â”€â†’ Creates project structure automatically

2. ğŸš€ Deploy.s.sol (Deployment Scripts)
   â””â”€â†’ Copy to: script/Deploy.s.sol
   â””â”€â†’ Contains deployment logic for both testing and production

ğŸ§ª TESTS (Implement These)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. ğŸ”¬ PseudoArbitrage.t.sol (Unit Tests)
   â””â”€â†’ Copy to: test/PseudoArbitrage.t.sol
   â””â”€â†’ Tests core pseudo-arbitrage logic

2. ğŸ§© PseudoArbitrageIntegration.t.sol (Integration Tests)
   â””â”€â†’ Copy to: test/PseudoArbitrageIntegration.t.sol
   â””â”€â†’ Tests complete system end-to-end

âš¡ QUICK START (3 Options)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OPTION 1: Automated (Fastest)                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ $ chmod +x setup.sh                                                 â”‚
â”‚ $ ./setup.sh                                                        â”‚
â”‚ $ # Follow on-screen instructions                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OPTION 2: Manual Setup                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Read README.md for overview                                      â”‚
â”‚ 2. Follow STEP_BY_STEP_GUIDE.md                                     â”‚
â”‚ 3. Copy files to correct locations                                  â”‚
â”‚ 4. Install dependencies: forge install                              â”‚
â”‚ 5. Build: forge build                                               â”‚
â”‚ 6. Test: forge test                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OPTION 3: Existing Project                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ If you already have a Foundry project:                              â”‚
â”‚ 1. Copy contract files to your src/ directory                       â”‚
â”‚ 2. Copy test files to your test/ directory                          â”‚
â”‚ 3. Copy deploy script to your script/ directory                     â”‚
â”‚ 4. Install: forge install 1inch/swap-vm                             â”‚
â”‚ 5. Build: forge build                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ¯ DEPLOYMENT CHECKLIST
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”Œâ”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚ Task                                              â”‚ Status       â”‚
â”œâ”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚â–¡ â”‚ Install Foundry                                   â”‚ Required     â”‚
â”‚â–¡ â”‚ Run setup.sh or manual setup                      â”‚ Required     â”‚
â”‚â–¡ â”‚ Install SwapVM dependency                         â”‚ Required     â”‚
â”‚â–¡ â”‚ Copy contract files to correct directories        â”‚ Required     â”‚
â”‚â–¡ â”‚ Fix import paths                                  â”‚ Required     â”‚
â”‚â–¡ â”‚ Successful compilation (forge build)              â”‚ Required     â”‚
â”‚â–¡ â”‚ Unit tests pass                                   â”‚ Required     â”‚
â”‚â–¡ â”‚ Deploy to local Anvil                             â”‚ Recommended  â”‚
â”‚â–¡ â”‚ Integration tests pass                            â”‚ Recommended  â”‚
â”‚â–¡ â”‚ Deploy to testnet                                 â”‚ Recommended  â”‚
â”‚â–¡ â”‚ Professional audit                                â”‚ For mainnet  â”‚
â”‚â–¡ â”‚ Deploy to mainnet                                 â”‚ Final step   â”‚
â””â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”‘ KEY DEPENDENCIES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Your contracts need:

1. âš ï¸ 1inch SwapVM Framework (Critical)
   â”œâ”€â†’ Contains: VM, Context, Instructions
   â”œâ”€â†’ Install: forge install 1inch/swap-vm
   â””â”€â†’ Or: git clone https://github.com/1inch/swap-vm.git lib/swap-vm

2. ğŸ“¦ OpenZeppelin Contracts
   â”œâ”€â†’ Contains: SafeCast, Math utilities
   â”œâ”€â†’ Install: forge install OpenZeppelin/openzeppelin-contracts@v5.1.0
   â””â”€â†’ Included in setup.sh

3. ğŸ”— Aqua Settlement Layer
   â”œâ”€â†’ Production: Get address from 1inch
   â””â”€â†’ Testing: Use MockAqua (included in Deploy.s.sol)

âš ï¸ CRITICAL NOTES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Import Path Fixes Required
   Your contracts have relative imports:
   âŒ import { Context } from "../libs/VM.sol";
   âœ… import { Context } from "swap-vm/libs/VM.sol";

2. SwapVM Installation is Mandatory
   Without SwapVM, contracts won't compile.
   The framework provides essential infrastructure.

3. Solidity Version: 0.8.30
   Must use exact version. Check with: forge --version

4. Test on Testnet First
   Never deploy directly to mainnet.
   Use Sepolia or other testnets.

5. Get Professional Audit
   Before mainnet deployment with real funds.

ğŸ“Š PROJECT STRUCTURE (After Setup)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

pseudo-arbitrage-amm/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ instructions/
â”‚   â”‚   â””â”€â”€ PseudoArbitrage.sol â† Your file
â”‚   â”œâ”€â”€ opcodes/
â”‚   â”‚   â””â”€â”€ PseudoArbitrageOpcodes.sol â† Your file
â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â””â”€â”€ PseudoArbitrageSwapVMRouter.sol â† Your file
â”‚   â””â”€â”€ strategies/
â”‚       â””â”€â”€ PseudoArbitrageAMM.sol â† Your file
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ PseudoArbitrage.t.sol
â”‚   â””â”€â”€ PseudoArbitrageIntegration.t.sol
â”œâ”€â”€ script/
â”‚   â””â”€â”€ Deploy.s.sol
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ forge-std/
â”‚   â”œâ”€â”€ openzeppelin-contracts/
â”‚   â””â”€â”€ swap-vm/ â† Must install!
â”œâ”€â”€ foundry.toml
â”œâ”€â”€ .env (create from .env.example)
â””â”€â”€ Makefile

ğŸ”— USEFUL COMMANDS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Build:
  $ forge build
  $ make build

Test:
  $ forge test -vv
  $ make test
  $ make test-gas  # With gas reporting

Deploy Local:
  $ anvil  # Terminal 1
  $ make deploy-local  # Terminal 2

Deploy Testnet:
  $ make deploy-testnet
  $ forge script script/Deploy.s.sol --rpc-url $RPC_URL --broadcast

Format Code:
  $ forge fmt
  $ make format

Clean:
  $ forge clean
  $ make clean

ğŸ†˜ TROUBLESHOOTING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âŒ "Cannot find SwapVM imports"
   â””â”€â†’ Install: git clone https://github.com/1inch/swap-vm.git lib/swap-vm
   â””â”€â†’ Fix remappings in foundry.toml

âŒ "Compilation failed"
   â””â”€â†’ Check Solidity version: forge --version
   â””â”€â†’ Run: forge clean && forge build

âŒ "Tests won't run"
   â””â”€â†’ Install: forge install foundry-rs/forge-std

âŒ "Import paths broken"
   â””â”€â†’ Update imports from relative to remapped paths
   â””â”€â†’ See STEP_BY_STEP_GUIDE.md for examples

ğŸ“š LEARNING RESOURCES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“„ Paper: https://arxiv.org/abs/2106.00667 (Engel & Herlihy)
ğŸ“˜ SwapVM: https://github.com/1inch/swap-vm
ğŸ“— Foundry: https://book.getfoundry.sh/
ğŸ“™ OpenZeppelin: https://docs.openzeppelin.com/contracts

ğŸ“ What This System Does
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Traditional AMM:
  Price changes â†’ Arbitrageurs profit â†’ LPs lose (divergence loss)

Pseudo-Arbitrage AMM:
  Price changes â†’ Curve transforms â†’ LPs keep value (no loss!)

How:
  1. Oracle reports new price
  2. Calculate curve transformation
  3. Shift effective balances
  4. Future swaps use transformed curve
  5. LPs maintain value despite price changes

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Ready to start? â†’ chmod +x setup.sh && ./setup.sh

Questions? â†’ Read STEP_BY_STEP_GUIDE.md

Good luck! ğŸš€

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
